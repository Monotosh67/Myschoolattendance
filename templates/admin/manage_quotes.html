{% extends "base.html" %}

{% block title %}Manage Quotes - Admin{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <h1><i class="fas fa-quote-right"></i> Motivational Quotes</h1>
        <p>Manage daily motivational quotes shown on the dashboard</p>
    </div>

    <!-- Add Quote Form -->
    <div class="card">
        <div class="card-header">
            <h3><i class="fas fa-plus-circle"></i> Add New Quote</h3>
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('manage_quotes') }}" id="addQuoteForm">
                <input type="hidden" name="action" value="add">
                
                <div class="form-group">
                    <label><i class="fas fa-quote-left"></i> Quote Text *</label>
                    <textarea name="quote" class="form-textarea" rows="3" required 
                              placeholder="Enter motivational quote..."></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Author</label>
                        <input type="text" name="author" class="form-input" 
                               placeholder="Author name (optional)">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-tags"></i> Category</label>
                        <select name="category" class="form-select">
                            <option value="motivation">Motivation</option>
                            <option value="education">Education</option>
                            <option value="success">Success</option>
                            <option value="teacher">Teacher</option>
                            <option value="student">Student</option>
                            <option value="life">Life</option>
                            <option value="inspiration">Inspiration</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-toggle-on"></i> Status</label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="is_active" checked>
                            <span class="checkmark"></span>
                            Active (shown on dashboard)
                        </label>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-plus"></i> Add Quote
                    </button>
                </div>
            </form>
            
            <div class="quote-preview">
                <h4><i class="fas fa-eye"></i> Preview</h4>
                <div class="preview-card">
                    <div class="preview-icon">
                        <i class="fas fa-quote-left"></i>
                    </div>
                    <div class="preview-content">
                        <p id="previewQuote">Your quote will appear here...</p>
                        <div class="preview-author">
                            <span id="previewAuthor">Author</span>
                            <span class="preview-category" id="previewCategory">motivation</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quotes List -->
    <div class="card">
        <div class="card-header">
            <h3><i class="fas fa-list"></i> All Quotes</h3>
            <span class="badge">{{ quotes|length }} Quotes</span>
        </div>
        
        <div class="card-body">
            <div class="quotes-grid">
                {% for quote in quotes %}
                <div class="quote-card {% if not quote.is_active %}inactive{% endif %}">
                    <div class="quote-header">
                        <span class="quote-category {{ quote.category }}">
                            <i class="fas fa-{{ get_quote_icon(quote.category) }}"></i>
                            {{ quote.category|capitalize }}
                        </span>
                        <div class="quote-actions">
                            <button class="btn-icon btn-warning" 
                                    onclick="editQuote({{ quote.id }})"
                                    title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon btn-danger" 
                                    onclick="deleteQuote({{ quote.id }})"
                                    title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="quote-body">
                        <div class="quote-icon">
                            <i class="fas fa-quote-left"></i>
                        </div>
                        <p class="quote-text">{{ quote.quote }}</p>
                    </div>
                    
                    <div class="quote-footer">
                        <div class="quote-author">
                            {% if quote.author %}
                            <i class="fas fa-user"></i> {{ quote.author }}
                            {% endif %}
                        </div>
                        <div class="quote-status">
                            {% if quote.is_active %}
                            <span class="status-badge active">
                                <i class="fas fa-eye"></i> Active
                            </span>
                            {% else %}
                            <span class="status-badge inactive">
                                <i class="fas fa-eye-slash"></i> Inactive
                            </span>
                            {% endif %}
                            <span class="quote-date">
                                {{ quote.created_at.strftime('%d/%m/%Y') }}
                            </span>
                        </div>
                    </div>
                </div>
                {% endfor %}
                
                {% if quotes|length == 0 %}
                <div class="empty-state">
                    <i class="fas fa-quote-right fa-3x"></i>
                    <h4>No Quotes Created</h4>
                    <p>Add your first motivational quote</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Edit Quote Modal -->
<div class="modal-overlay" id="editQuoteModal">
    <div class="modal">
        <div class="modal-header">
            <h3><i class="fas fa-edit"></i> Edit Quote</h3>
            <button class="modal-close" onclick="closeModal('editQuoteModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <form method="POST" action="{{ url_for('manage_quotes') }}" id="editQuoteForm">
            <input type="hidden" name="action" value="edit">
            <input type="hidden" name="quote_id" id="editQuoteId">
            
            <div class="modal-body">
                <div class="form-group">
                    <label><i class="fas fa-quote-left"></i> Quote Text</label>
                    <textarea name="quote" id="editQuoteText" 
                              class="form-textarea" rows="3" required></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label><i class="fas fa-user"></i> Author</label>
                        <input type="text" name="author" id="editQuoteAuthor" 
                               class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-tags"></i> Category</label>
                        <select name="category" id="editQuoteCategory" class="form-select">
                            <option value="motivation">Motivation</option>
                            <option value="education">Education</option>
                            <option value="success">Success</option>
                            <option value="teacher">Teacher</option>
                            <option value="student">Student</option>
                            <option value="life">Life</option>
                            <option value="inspiration">Inspiration</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-toggle-on"></i> Status</label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="is_active" id="editQuoteActive">
                            <span class="checkmark"></span>
                            Active (shown on dashboard)
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeModal('editQuoteModal')">
                    Cancel
                </button>
                <button type="submit" class="btn-primary">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.checkbox-label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-size: 14px;
    color: var(--light);
}

.checkbox-label input {
    display: none;
}

.checkmark {
    width: 20px;
    height: 20px;
    border: 2px solid var(--primary);
    border-radius: 4px;
    margin-right: 10px;
    position: relative;
    transition: all 0.3s;
}

.checkbox-label input:checked + .checkmark {
    background: var(--primary);
}

.checkbox-label input:checked + .checkmark::after {
    content: 'âœ“';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 12px;
    font-weight: bold;
}

.quote-preview {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid var(--card-border);
}

.preview-card {
    display: flex;
    gap: 20px;
    padding: 20px;
    background: rgba(0, 212, 255, 0.1);
    border-radius: 12px;
    border: 1px solid var(--card-border);
    margin-top: 15px;
}

.preview-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--accent));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
}

.preview-content {
    flex: 1;
}

.preview-content p {
    font-size: 16px;
    line-height: 1.6;
    margin-bottom: 10px;
    color: var(--light);
    font-style: italic;
}

.preview-author {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.preview-author span:first-child {
    font-weight: 500;
    color: var(--primary);
}

.preview-category {
    padding: 2px 10px;
    background: rgba(255, 0, 234, 0.1);
    color: var(--secondary);
    border-radius: 12px;
    font-size: 12px;
    border: 1px solid var(--secondary);
}

.quotes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.quote-card {
    background: rgba(20, 25, 50, 0.5);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    overflow: hidden;
    transition: all 0.3s;
}

.quote-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 212, 255, 0.2);
    border-color: var(--primary);
}

.quote-card.inactive {
    opacity: 0.6;
    filter: grayscale(0.5);
}

.quote-header {
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--card-border);
}

.quote-category {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.quote-category.motivation {
    background: rgba(0, 212, 255, 0.15);
    color: var(--primary);
    border: 1px solid var(--primary);
}

.quote-category.education {
    background: rgba(0, 204, 102, 0.15);
    color: var(--success);
    border: 1px solid var(--success);
}

.quote-category.success {
    background: rgba(255, 170, 0, 0.15);
    color: var(--warning);
    border: 1px solid var(--warning);
}

.quote-category.teacher {
    background: rgba(255, 0, 234, 0.15);
    color: var(--secondary);
    border: 1px solid var(--secondary);
}

.quote-body {
    padding: 20px;
    display: flex;
    gap: 15px;
    align-items: flex-start;
}

.quote-icon {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--primary), var(--accent));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 14px;
    flex-shrink: 0;
}

.quote-text {
    flex: 1;
    font-size: 14px;
    line-height: 1.6;
    color: var(--light);
    font-style: italic;
    margin: 0;
}

.quote-footer {
    padding: 15px;
    border-top: 1px solid var(--card-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(0, 0, 0, 0.2);
}

.quote-author {
    font-size: 13px;
    color: var(--gray);
    display: flex;
    align-items: center;
    gap: 6px;
}

.quote-status {
    display: flex;
    align-items: center;
    gap: 10px;
}

.quote-date {
    font-size: 12px;
    color: var(--gray);
}

@media (max-width: 768px) {
    .quotes-grid {
        grid-template-columns: 1fr;
    }
    
    .preview-card {
        flex-direction: column;
        text-align: center;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Get quote icon based on category
function get_quote_icon(category) {
    const icons = {
        'motivation': 'rocket',
        'education': 'graduation-cap',
        'success': 'trophy',
        'teacher': 'chalkboard-teacher',
        'student': 'user-graduate',
        'life': 'heart',
        'inspiration': 'lightbulb'
    };
    return icons[category] || 'quote-right';
}

// Update preview
function updatePreview() {
    const quote = document.querySelector('textarea[name="quote"]').value;
    const author = document.querySelector('input[name="author"]').value;
    const category = document.querySelector('select[name="category"]').value;
    
    document.getElementById('previewQuote').textContent = quote || 'Your quote will appear here...';
    document.getElementById('previewAuthor').textContent = author || 'Anonymous';
    document.getElementById('previewCategory').textContent = category;
    document.getElementById('previewCategory').className = 'preview-category';
}

// Edit quote
function editQuote(quoteId) {
    fetch(`/api/quote/${quoteId}`)
        .then(response => response.json())
        .then(quote => {
            document.getElementById('editQuoteId').value = quoteId;
            document.getElementById('editQuoteText').value = quote.quote;
            document.getElementById('editQuoteAuthor').value = quote.author || '';
            document.getElementById('editQuoteCategory').value = quote.category;
            document.getElementById('editQuoteActive').checked = quote.is_active;
            
            document.getElementById('editQuoteModal').classList.add('active');
        })
        .catch(error => {
            alert('Error loading quote: ' + error.message);
        });
}

// Delete quote
function deleteQuote(quoteId) {
    if (confirm('Are you sure you want to delete this quote?')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = "{{ url_for('manage_quotes') }}";
        
        const actionInput = document.createElement('input');
        actionInput.type = 'hidden';
        actionInput.name = 'action';
        actionInput.value = 'delete';
        
        const quoteIdInput = document.createElement('input');
        quoteIdInput.type = 'hidden';
        quoteIdInput.name = 'quote_id';
        quoteIdInput.value = quoteId;
        
        form.appendChild(actionInput);
        form.appendChild(quoteIdInput);
        document.body.appendChild(form);
        form.submit();
    }
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    const quoteText = document.querySelector('textarea[name="quote"]');
    const authorInput = document.querySelector('input[name="author"]');
    const categorySelect = document.querySelector('select[name="category"]');
    
    if (quoteText) {
        quoteText.addEventListener('input', updatePreview);
        authorInput.addEventListener('input', updatePreview);
        categorySelect.addEventListener('change', updatePreview);
        updatePreview(); // Initial update
    }
});
</script>
{% endblock %}
